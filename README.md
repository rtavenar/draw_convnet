# draw_convnet

## History

Python script for illustrating Convolutional Neural Network (ConvNet)
for `keras` and `pytorch` models.
At the moment, the code can only deal with `Sequential` models with the following layers:

| `keras`       | `pytorch`   |
|---------------|-------------|
| `InputLayer`, |             |
| `Conv2D`,     | `Conv2d`    |
| `MaxPool2D`,  | `MaxPool2d` |
| `AvgPool2D`,  | `AvgPool2d` |
| `Flatten`,    | `Flatten`,  |
| `Dense`       | `Linear`    |


This is based on <https://github.com/gwding/draw_convnet>, whose statement about using / citing the code is:

> It is NOT required to cite anything to use the code.
>
> If you are not facing space limitation and it does not break the flow of the paper, you might consider adding something like "This figure is generated by adapting the code from https://github.com/gwding/draw_convnet" (maybe in the footnote).
>
> FYI, originally I used the code to generate the convnet figure in this paper "Automatic moth detection from trap images for pest management".

## Plotting `keras` models

```python
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import InputLayer, Conv2D, MaxPool2D, AvgPool2D, Flatten, Dense

input_image = InputLayer((32, 32, 3))
model = Sequential([
    Conv2D(filters=32, kernel_size=3, padding="valid"),
    MaxPool2D(pool_size=2),
    Conv2D(filters=32, kernel_size=5, padding="same"),
    AvgPool2D(pool_size=2),
    Flatten(),
    Dense(units=124),
    Dense(units=10)
])
plot_keras_convnet(input_image, model, font_size=6)
plt.show()  # Not required in notebooks
```

Alternatively, if the goal is to save the model diagram to a file, the last lines of the previous code would become:

```python
plot_keras_convnet(input_image, model, font_size=6, to_file="convnet_keras.svg")
```

## Plotting `pytorch` models

```python
from pprint import pprint
import torch
import torch.nn as nn

input_image = torch.randn(3, 32, 32)  # (C, H, W)
model = nn.Sequential(
    nn.Conv2d(in_channels=3, out_channels=32, kernel_size=3, padding="valid"),
    nn.MaxPool2d(kernel_size=2),
    nn.Conv2d(in_channels=32, out_channels=32, kernel_size=5, padding="same"),
    nn.AvgPool2d(kernel_size=(2)),
    nn.Flatten(),  # if image shape==(3, 32, 32), Flatten gives (1, 1568)
    nn.Linear(in_features=1568, out_features=124),
    nn.Linear(in_features=124, out_features=10),
)
plot_pytorch_convnet(input_image, model, font_size=6)
plt.show()  # Not required in notebooks
```

Alternatively, if the goal is to save the model diagram to a file, the last lines of the previous code would become:

```python
plot_pytorch_convnet(input_image, model, font_size=6, to_file="convnet_pytorch.svg")
```

## Installation

Ideally, installation should be as simple as:

```bash
python -m pip install git+https://github.com/rtavenar/draw_convnet.git
```
